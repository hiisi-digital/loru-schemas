[meta]
schema_version = "0.3.5"

[[lib]]
kind = "deno"
name = "@loru/schemas"
path = "."

[[lib]]
kind = "rust"
name = "loru-schemas"
path = "rust"

[[task]]
cmd  = "deno run -A scripts/validate-schemas.ts && deno run -A scripts/generate-ts.ts && deno run -A scripts/generate-rust.ts"
name = "gen"

[[check.task]]
cmd   = "sh -c 'ROOT=$(git rev-parse --show-toplevel 2>/dev/null || pwd); cd \"$ROOT\" && deno run -A scripts/validate-schemas.ts && if [ -f \"$ROOT/typescript/mod.ts\" ]; then deno check \"$ROOT/typescript/mod.ts\"; else echo \"No TS output to check\"; fi'"
stage = "check"

[[check.task]]
cmd   = "sh -c 'ROOT=$(git rev-parse --show-toplevel 2>/dev/null || pwd); cd \"$ROOT/rust\" && cargo fmt -- --check && cargo check && cargo clippy && cargo test'"
stage = "test"
